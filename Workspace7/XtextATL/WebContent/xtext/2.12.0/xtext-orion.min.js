define("xtext/compatibility",[],function(){return Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("bind target is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){};return boundFunc=function(){var i=Array.prototype.slice.call(arguments);return n.apply(this instanceof r?this:e,t.concat(i))},r.prototype=this.prototype,boundFunc.prototype=new r,boundFunc}),Array.prototype.map||(Array.prototype.map=function(e,t){if(this==null)throw new TypeError("this is null");if(typeof e!="function")throw new TypeError("callback is not callable");var n=Object(this),r=n.length>>>0,i=new Array(r);for(var s=0;s<r;s++)s in n&&(i[s]=e.call(t,n[s],s,n));return i}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){if(this==null)throw new TypeError("this is null");if(typeof e!="function")throw new TypeError("callback is not callable");var n=Object(this),r=n.length>>>0;for(var i=0;i<r;i++)i in n&&e.call(t,n[i],i,n)}),{}}),define("xtext/services/XtextService",["jquery"],function(e){function n(){}var t={};return n.prototype.initialize=function(){this._serviceType=arguments[1];if(typeof arguments[0]=="string"){this._requestUrl=arguments[0]+"/"+this._serviceType;var e=arguments[2];e&&(this._encodedResourceId=encodeURIComponent(e)),this._updateService=arguments[3]}else{var t=arguments[0];if(t.options){this._requestUrl=t.options.serviceUrl+"/"+this._serviceType;var e=t.options.resourceId;e&&(this._encodedResourceId=encodeURIComponent(e))}this._updateService=t.updateService}},n.prototype.setState=function(e){this._state=e},n.prototype.invoke=function(t,n,r,i){r===undefined&&(r=e.Deferred());if(e.isFunction(this._checkPreconditions)&&!this._checkPreconditions(t,n))return r.reject(),r.promise();var s={contentType:n.contentType},o;e.isFunction(this._initServerData)&&(o=this._initServerData(s,t,n));var u="GET";o&&o.httpMethod&&(u=o.httpMethod);var a=this;if(!o||!o.suppressContent)if(n.sendFullText)s.fullText=t.getText(),u="POST";else{var f=t.getServerState();if(f.updateInProgress)return a._updateService?a._updateService.addCompletionCallback(function(){a.invoke(t,n,r)}):r.reject(),r.promise();f.stateId!==undefined&&(s.requiredStateId=f.stateId)}var l;e.isFunction(this._getSuccessCallback)?l=this._getSuccessCallback(t,n,r):l=function(i){if(i.conflict){if(a._increaseRecursionCount(t)){var s;e.isFunction(a._onConflict)&&(s=a._onConflict(t,i.conflict));if((!s||!s.suppressForcedUpdate)&&!n.sendFullText&&i.conflict=="invalidStateId"&&a._updateService){a._updateService.addCompletionCallback(function(){a.invoke(t,n,r)});var o=t.getServerState();delete o.stateId,delete o.text,a._updateService.invoke(t,n)}else a.invoke(t,n,r)}else r.reject();return!1}if(e.isFunction(a._processResult)){var u=a._processResult(i,t);if(u)return r.resolve(u),!0}r.resolve(i)};var c=function(i,s,o){if(i.status==404&&!n.loadFromServer&&a._increaseRecursionCount(t)){var u;e.isFunction(a._onConflict)&&(u=a._onConflict(t,o));var f=t.getServerState();if((!u||!u.suppressForcedUpdate)&&f.text!==undefined&&a._updateService)return a._updateService.addCompletionCallback(function(){a.invoke(t,n,r)}),delete f.stateId,delete f.text,a._updateService.invoke(t,n),!0}r.reject(o)};return a.sendRequest(t,{type:u,data:s,success:l,error:c},!n.sendFullText),r.promise().always(function(){a._recursionCount=undefined})},n.prototype.sendRequest=function(n,r,i){var s=this;s.setState("started");var o=r.success;r.success=function(t){var r=!0;e.isFunction(o)&&(r=o(t));if(r||r===undefined){s.setState("finished");if(n.xtextServices){var i=n.xtextServices.successListeners;if(i)for(var u=0;u<i.length;u++){var a=i[u];e.isFunction(a)&&a(s._serviceType,t)}}}};var u=r.error;r.error=function(t,r,i){var o=!1;e.isFunction(u)&&(o=u(t,r,i)),o||(s.setState(undefined),s._reportError(n,r,i,t))},r.async=!0;var a=s._requestUrl;!r.data.resource&&s._encodedResourceId&&(a.indexOf("?")>=0?a+="&resource="+s._encodedResourceId:a+="?resource="+s._encodedResourceId);if(i&&t._initPending)t._waitingRequests||(t._waitingRequests=[]),t._waitingRequests.push({requestUrl:a,settings:r});else{if(i&&!t._initDone){t._initPending=!0;var f=r.complete;r.complete=function(n,r){e.isFunction(f)&&f(n,r),delete t._initPending,t._initDone=!0;if(t._waitingRequests){for(var i=0;i<t._waitingRequests.length;i++){var s=t._waitingRequests[i];e.ajax(s.requestUrl,s.settings)}delete t._waitingRequests}}}e.ajax(a,r)}},n.prototype._increaseRecursionCount=function(e){return this._recursionCount===undefined?this._recursionCount=1:this._recursionCount++,this._recursionCount>=10?(this._reportError(e,"warning","Xtext service request failed after 10 attempts.",{}),!1):!0},n.prototype._reportError=function(t,n,r,i){if(t.xtextServices){var s=t.xtextServices.errorListeners;if(s)for(var o=0;o<s.length;o++){var u=s[o];e.isFunction(u)&&u(this._serviceType,n,r,i)}}},n}),define("xtext/services/LoadResourceService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t,n){this.initialize(e,n?"revert":"load",t)}return n.prototype=new e,n.prototype._initServerData=function(e,t,n){return{suppressContent:!0,httpMethod:this._serviceType=="revert"?"POST":"GET"}},n.prototype._getSuccessCallback=function(e,t,n){return function(r){e.setText(r.fullText),e.clearUndoStack(),e.setDirty(r.dirty);var i=e.updateServerState(r.fullText,r.stateId);for(var s=0;s<i.length;s++)i[s](t);n.resolve(r)}},n}),define("xtext/services/SaveResourceService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t){this.initialize(e,"save",t)}return n.prototype=new e,n.prototype._initServerData=function(e,t,n){return{httpMethod:"POST"}},n.prototype._processResult=function(e,t){t.setDirty(!1)},n}),define("xtext/services/HighlightingService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t){this.initialize(e,"highlight",t)}return n.prototype=new e,n.prototype._checkPreconditions=function(e,t){return this._state===undefined},n.prototype._onConflict=function(e,t){return this.setState(undefined),{suppressForcedUpdate:!0}},n}),define("xtext/services/ValidationService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t){this.initialize(e,"validate",t)}return n.prototype=new e,n.prototype._checkPreconditions=function(e,t){return this._state===undefined},n.prototype._onConflict=function(e,t){return this.setState(undefined),{suppressForcedUpdate:!0}},n}),define("xtext/services/UpdateService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t){this.initialize(e,"update",t,this),this._completionCallbacks=[]}return n.prototype=new e,n.prototype.computeDelta=function(e,t,n){var r=0,i=e.length,s=t.length;while(r<i&&r<s&&e.charCodeAt(r)===t.charCodeAt(r))r++;if(r===i&&r===s)return;n.deltaOffset=r;if(r===i){n.deltaText=t.substring(r,s),n.deltaReplaceLength=0;return}if(r===s){n.deltaText="",n.deltaReplaceLength=i-r;return}var o=i-1,u=s-1;while(o>=r&&u>=r&&e.charCodeAt(o)===t.charCodeAt(u))o--,u--;n.deltaText=t.substring(r,u+1),n.deltaReplaceLength=o-r+1},n.prototype.onComplete=function(e,t){var n=this._completionCallbacks;this._completionCallbacks=[];for(var r=0;r<n.length;r++){var i=n[r].callback,s=n[r].params;i(s)}},n.prototype.addCompletionCallback=function(e,t){this._completionCallbacks.push({callback:e,params:t})},n.prototype.invoke=function(e,n,r){r===undefined&&(r=t.Deferred());var i=e.getServerState();if(i.updateInProgress){var s=this;return this.addCompletionCallback(function(){s.invoke(e,n,r)}),r.promise()}var o={contentType:n.contentType},u=e.getText();if(n.sendFullText||i.text===undefined)o.fullText=u;else{this.computeDelta(i.text,u,o);if(o.deltaText===undefined){if(!n.forceUpdate)return r.resolve(i),this.onComplete(),r.promise();o.deltaText="",o.deltaOffset=e.getCaretOffset(),o.deltaReplaceLength=0}o.requiredStateId=i.stateId}i.updateInProgress=!0;var s=this;return s.sendRequest(e,{type:"PUT",data:o,success:function(t){if(t.conflict)return i.text!==undefined?(delete i.updateInProgress,delete i.text,delete i.stateId,s.invoke(e,n,r)):r.reject(t.conflict),!1;var o=e.updateServerState(u,t.stateId);for(var a=0;a<o.length;a++)s.addCompletionCallback(o[a],n);r.resolve(t)},error:function(t,o,u){if(t.status==404&&!n.loadFromServer&&i.text!==undefined)return delete i.updateInProgress,delete i.text,delete i.stateId,s.invoke(e,n,r),!0;r.reject(u)},complete:s.onComplete.bind(s)},!0),r.promise().always(function(){i.updateInProgress=!1})},n}),define("xtext/services/ContentAssistService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t,n){this.initialize(e,"assist",t,n)}return n.prototype=new e,n.prototype.invoke=function(e,n,r){r===undefined&&(r=t.Deferred());var i={contentType:n.contentType};n.offset?i.caretOffset=n.offset:i.caretOffset=e.getCaretOffset();var s=n.selection?n.selection:e.getSelection();if(s.start!=i.caretOffset||s.end!=i.caretOffset)i.selectionStart=s.start,i.selectionEnd=s.end;var o,u="GET",a=undefined,f=e.getServerState();if(n.sendFullText)i.fullText=e.getText(),u="POST";else{i.requiredStateId=f.stateId;if(this._updateService){if(f.text===undefined||f.updateInProgress){var l=this;return this._updateService.addCompletionCallback(function(){l.invoke(e,n,r)}),r.promise()}f.updateInProgress=!0,a=this._updateService.onComplete.bind(this._updateService),o=e.getText(),this._updateService.computeDelta(f.text,o,i),i.deltaText!==undefined&&(u="POST")}}var l=this;l.sendRequest(e,{type:u,data:i,success:function(t){if(t.conflict){if(l._increaseRecursionCount(e))if(a)delete f.updateInProgress,delete f.text,delete f.stateId,l._updateService.addCompletionCallback(function(){l.invoke(e,n,r)}),l._updateService.invoke(e,n);else{var i={};for(var s in n)n.hasOwnProperty(s)&&(i[s]=n[s]);i.sendFullText=!0,l.invoke(e,i,r)}else r.reject(t.conflict);return!1}if(a&&t.stateId!==undefined&&t.stateId!=e.getServerState().stateId){var u=e.updateServerState(o,t.stateId);for(var c=0;c<u.length;c++)l._updateService.addCompletionCallback(u[c],n)}r.resolve(t.entries)},error:function(t,i,s){if(a&&t.status==404&&!n.loadFromServer&&f.text!==undefined)return delete f.updateInProgress,delete f.text,delete f.stateId,l._updateService.addCompletionCallback(function(){l.invoke(e,n,r)}),l._updateService.invoke(e,n),!0;r.reject(s)},complete:a},!n.sendFullText);var c=r.promise();return a&&c.always(function(){f.updateInProgress=!1}),c},n}),define("xtext/services/HoverService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t,n){this.initialize(e,"hover",t,n)}return n.prototype=new e,n.prototype._initServerData=function(e,t,n){n.proposal&&n.proposal.proposal&&(e.proposal=n.proposal.proposal),n.offset?e.caretOffset=n.offset:e.caretOffset=t.getCaretOffset();var r=n.selection?n.selection:t.getSelection();if(r.start!=e.caretOffset||r.end!=e.caretOffset)e.selectionStart=r.start,e.selectionEnd=r.end},n.prototype._getSuccessCallback=function(e,t,n){var r=t.mouseHoverDelay;r||(r=500);var i=(new Date).getTime()+r;return function(r){if(r.conflict||!r.title&&!r.content)n.reject();else{var s=Math.max(0,i-(new Date).getTime());setTimeout(function(){!t.sendFullText&&r.stateId!==undefined&&r.stateId!=e.getServerState().stateId?n.reject():n.resolve(r)},s)}}},n}),define("xtext/services/OccurrencesService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t,n){this.initialize(e,"occurrences",t,n)}return n.prototype=new e,n.prototype._initServerData=function(e,t,n){n.offset?e.caretOffset=n.offset:e.caretOffset=t.getCaretOffset()},n.prototype._getSuccessCallback=function(e,t,n){return function(r){r.conflict||!t.sendFullText&&r.stateId!==undefined&&r.stateId!=e.getServerState().stateId?n.reject():n.resolve(r)}},n}),define("xtext/services/FormattingService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t,n){this.initialize(e,"format",t,n)}return n.prototype=new e,n.prototype._initServerData=function(e,t,n){var r=n.selection?n.selection:t.getSelection();return r.end>r.start&&(e.selectionStart=r.start,e.selectionEnd=r.end),{httpMethod:"POST"}},n.prototype._processResult=function(e,t){var n;if(e.replaceRegion){var r=t.getText(),i=e.replaceRegion.offset,s=e.replaceRegion.offset+e.replaceRegion.length;t.setText(e.formattedText,i,s),n=r.substring(0,i)+e.formattedText+r.substring(s)}else t.setText(e.formattedText),n=e.formattedText;var o=t.updateServerState(n,e.stateId);for(var u=0;u<o.length;u++)o[u]({})},n}),define("xtext/ServiceBuilder",["jquery","xtext/services/XtextService","xtext/services/LoadResourceService","xtext/services/SaveResourceService","xtext/services/HighlightingService","xtext/services/ValidationService","xtext/services/UpdateService","xtext/services/ContentAssistService","xtext/services/HoverService","xtext/services/OccurrencesService","xtext/services/FormattingService"],function(e,t,n,r,i,s,o,u,a,f,l){function c(e){this.services=e}return c.prototype.createServices=function(){var h=this.services,p=h.options,d=h.editorContext;d.xtextServices=h;var v=this;p.serviceUrl||(p.baseUrl?p.baseUrl.charAt(0)!="/"&&(p.baseUrl="/"+p.baseUrl):p.baseUrl="/",p.serviceUrl=window.location.protocol+"//"+window.location.host+p.baseUrl+"xtext-service");if(p.resourceId)p.xtextLang||(p.xtextLang=p.resourceId.split(/[?#]/)[0].split(".").pop()),p.loadFromServer===undefined&&(p.loadFromServer=!0),p.loadFromServer&&this.setupPersistenceServices&&(h.loadResourceService=new n(p.serviceUrl,p.resourceId,!1),h.loadResource=function(e){return h.loadResourceService.invoke(d,c.mergeOptions(e,p))},h.saveResourceService=new r(p.serviceUrl,p.resourceId),h.saveResource=function(e){return h.saveResourceService.invoke(d,c.mergeOptions(e,p))},h.revertResourceService=new n(p.serviceUrl,p.resourceId,!0),h.revertResource=function(e){return h.revertResourceService.invoke(d,c.mergeOptions(e,p))},this.setupPersistenceServices(),h.loadResource());else{p.loadFromServer===undefined&&(p.loadFromServer=!1);if(p.xtextLang){var m=Math.floor(Math.random()*2147483648).toString(16);p.resourceId=m+"."+p.xtextLang}}this.setupSyntaxHighlighting&&this.setupSyntaxHighlighting();if(p.enableHighlightingService||p.enableHighlightingService===undefined)h.highlightingService=new i(p.serviceUrl,p.resourceId),h.computeHighlighting=function(e){return h.highlightingService.invoke(d,c.mergeOptions(e,p))};if(p.enableValidationService||p.enableValidationService===undefined)h.validationService=new s(p.serviceUrl,p.resourceId),h.validate=function(e){return h.validationService.invoke(d,c.mergeOptions(e,p))};if(this.setupUpdateService){function g(){h.highlightingService&&v.doHighlighting&&(h.highlightingService.setState(undefined),v.doHighlighting()),h.validationService&&v.doValidation&&(h.validationService.setState(undefined),v.doValidation())}p.sendFullText||(h.updateService=new o(p.serviceUrl,p.resourceId),h.update=function(e){return h.updateService.invoke(d,c.mergeOptions(e,p))},h.saveResourceService&&(h.saveResourceService._updateService=h.updateService),d.addServerStateListener(g)),this.setupUpdateService(g)}(p.enableContentAssistService||p.enableContentAssistService===undefined)&&this.setupContentAssistService&&(h.contentAssistService=new u(p.serviceUrl,p.resourceId,h.updateService),h.getContentAssist=function(e){return h.contentAssistService.invoke(d,c.mergeOptions(e,p))},this.setupContentAssistService()),(p.enableHoverService||p.enableHoverService===undefined)&&this.setupHoverService&&(h.hoverService=new a(p.serviceUrl,p.resourceId,h.updateService),h.getHoverInfo=function(e){return h.hoverService.invoke(d,c.mergeOptions(e,p))},this.setupHoverService()),(p.enableOccurrencesService||p.enableOccurrencesService===undefined)&&this.setupOccurrencesService&&(h.occurrencesService=new f(p.serviceUrl,p.resourceId,h.updateService),h.getOccurrences=function(e){return h.occurrencesService.invoke(d,c.mergeOptions(e,p))},this.setupOccurrencesService()),(p.enableFormattingService||p.enableFormattingService===undefined)&&this.setupFormattingService&&(h.formattingService=new l(p.serviceUrl,p.resourceId,h.updateService),h.format=function(e){return h.formattingService.invoke(d,c.mergeOptions(e,p))},this.setupFormattingService());if(p.enableGeneratorService||p.enableGeneratorService===undefined)h.generatorService=new t,h.generatorService.initialize(h,"generate"),h.generatorService._initServerData=function(e,t,n){n.allArtifacts?e.allArtifacts=n.allArtifacts:n.artifactId&&(e.artifact=n.artifactId),n.includeContent!==undefined&&(e.includeContent=n.includeContent)},h.generate=function(e){return h.generatorService.invoke(d,c.mergeOptions(e,p))};if(p.dirtyElement){var y=p.document||document,b;typeof p.dirtyElement=="string"?b=e("#"+p.dirtyElement,y):b=e(p.dirtyElement);var w=p.dirtyStatusClass;w||(w="dirty"),d.addDirtyStateListener(function(e){e?b.addClass(w):b.removeClass(w)})}h.successListeners=[],h.errorListeners=[function(e,t,n,r){p.showErrorDialogs?window.alert("Xtext service '"+e+"' failed: "+n):console.log("Xtext service '"+e+"' failed: "+n)}]},c.prototype.changeResource=function(t){var n=this.services,r=n.options;r.resourceId=t;for(var i in n)if(n.hasOwnProperty(i)){var s=n[i];s._serviceType&&e.isFunction(s.initialize)&&n[i].initialize(r.serviceUrl,s._serviceType,t,n.updateService)}var o=n.editorContext.getServerState();delete o.stateId,delete o.text,r.loadFromServer&&e.isFunction(n.loadResource)&&n.loadResource()},c.copy=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},c.optionName=function(e){var t="data-editor-";if(e.substring(0,t.length)===t){var n=e.substring(t.length);return n=n.replace(/-([a-z])/ig,function(e,t){return t.toUpperCase()}),n}return undefined},c.mergeOptions=function(e,t){if(e){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}return c.copy(t)},c.mergeParentOptions=function(e,t){var n=c.copy(t);for(var r,i=0,s=e.attributes,o=s.length;i<o;i++){r=s.item(i);var u=c.optionName(r.nodeName);if(u){var a=r.nodeValue;if(a==="true"||a==="false")a=a==="true";n[u]=a}}return n},c}),define("xtext/OrionEditorContext",[],function(){function e(e,t){this._editorViewer=e,this._editor=e.editor,this._contentType=t,this._serverState={},this._serverStateListeners=[],this._dirty=!1,this._dirtyStateListeners=[]}return e.prototype={getServerState:function(){return this._serverState},updateServerState:function(e,t){return this._serverState.text=e,this._serverState.stateId=t,this._serverStateListeners},addServerStateListener:function(e){this._serverStateListeners.push(e)},getCaretOffset:function(){return this._editor.getTextView().getCaretOffset()},getLineStart:function(e){var t=this._editor.getTextView();return t.getLineStart(t.getLineAtOffset(t.getCaretOffset()))},getSelection:function(){return this._editor.getTextView().getSelection()},getText:function(e,t){return this._editor.getText(e,t)},isDirty:function(){return this._dirty},setDirty:function(e){if(e!=this._dirty)for(var t=0;t<this._dirtyStateListeners.length;t++)this._dirtyStateListeners[t](e);this._dirty=e},addDirtyStateListener:function(e){this._dirtyStateListeners.push(e)},clearUndoStack:function(){this._editor.getUndoStack().reset()},setCaretOffset:function(e,t){this._editor.getTextView().setCaretOffset(e,t)},setSelection:function(e){this._editor.getTextView().setSelection(e.start,e.end)},setText:function(e,t,n){if(t===undefined||n===undefined)this._editorViewer.setContents(e,this._contentType);else{var r=this._editor.getText(),i=r.substring(0,t)+e+r.substring(n);this._editorViewer.setContents(i,this._contentType)}}},e}),define("xtext/xtext-orion",["jquery","orion/Deferred","orion/keyBinding","orion/editor/annotations","embeddedEditor/builder/embeddedEditor","xtext/compatibility","xtext/ServiceBuilder","xtext/OrionEditorContext"],function(e,t,n,r,i,s,o,u){function f(e,t){this.viewer=e,o.call(this,t)}var a={};return a.createEditor=function(t){t||(t={});var n;e.type(t.parent)==="string"?n=e("#"+t.parent,t.document):t.parent?n=e(t.parent):e.type(t.parentClass)==="string"?n=e("."+t.parentClass,t.document):(n=e("#xtext-editor",t.document),n.length==0&&(n=e(".xtext-editor",t.document)));var r=t.startupOptions;r||(r={defaultPlugins:["webToolsPlugin.html"]});var s=new i(r),u=[];n.each(function(e,n){var r=o.mergeParentOptions(n,t),i=a.registerContentType(s,r);u.push({parent:n,options:r,contentType:i})});var f=e.Deferred(),l=[],c=0;return u.forEach(function(t,r){function h(e){var s=a.createServices(e,t.options,i);s.options.loadFromServer||e.setContents(o,i),l[r]=e,c++,c==n.length&&(c==1?f.resolve(e):f.resolve(l))}function p(e){f.reject(e)}var i=t.contentType,o=e(t.parent).text(),u=s.create({parent:t.parent,contentType:i}),d=t.options.syntaxDefinition;d!="none"&&(e.type(d)==="string"||!d&&t.options.xtextLang)?(d||(d="xtext-resources/"+t.options.xtextLang+"-syntax"),require([d],function(e){t.options.syntaxDefinition=e,u.then(h,p)})):u.then(h,p)}),n.length==0&&f.reject(),f.promise()},f.prototype=new o,a.registerContentType=function(e,t){var n=t.xtextLang;!n&&t.resourceId&&(n=t.resourceId.split(/[?#]/)[0].split(".").pop());var r=t.contentType;!r&&t.xtextLang?r="xtext/"+t.xtextLang:r||(r="xtext");if(t.randomContentType===undefined||t.randomContentType)r=r+"_"+Math.floor(Math.random()*2147483648).toString(16);return e.serviceRegistry.registerService("orion.core.contenttype",{},{contentTypes:[{id:r,extension:[n],name:"Xtext Language","extends":"text/plain"}]}),r},a.createServices=function(e,t,n){!n&&t.contentType&&(n=t.contentType);var r={options:t,editorContext:new u(e,n),contentType:n,_highlightAnnotationTypes:[]},i=new f(e,r);return i.createServices(),r.serviceBuilder=i,e.xtextServices=r,r},a.removeServices=function(e){if(!e.xtextServices)return;var t=e.xtextServices;t.highlighterRegistration&&t.highlighterRegistration.unregister(),t.modelRegistration&&t.modelRegistration.unregister(),t.contentAssistRegistration&&t.contentAssistRegistration.unregister(),t.hoverRegistration&&t.hoverRegistration.unregister(),t.occurrencesRegistration&&t.occurrencesRegistration.unregister(),t.formatCommandRegistration&&t.formatCommandRegistration.unregister(),t.saveEventListener&&e.editor.removeEventListener("InputChanged",t.saveEventListener),e.editor.showAnnotations([],t._highlightAnnotationTypes),e.editor.showProblems([]),delete e.xtextServices},f.prototype.setupSyntaxHighlighting=function(){var t=this.services,n=t.options.syntaxDefinition;if(e.type(n)!=="string"){var r=t.contentType;n.contentTypes?e.inArray(r,n.contentTypes)<0&&n.contentTypes.push(r):n.contentTypes=[r],t.highlighterRegistration=this.viewer.serviceRegistry.registerService("orion.edit.highlighter",{},n)}},f.prototype.setupUpdateService=function(e){function i(i){n._xtext_init?n._xtext_init=!1:n.setDirty(!0),n._modelChangeTimeout&&clearTimeout(n._modelChangeTimeout),n._modelChangeTimeout=setTimeout(function(){t.options.sendFullText?e():t.update()},r)}var t=this.services,n=t.editorContext,r=t.options.textUpdateDelay;r||(r=500),n._xtext_init=!0,t.modelRegistration=this.viewer.serviceRegistry.registerService("orion.edit.model",{onModelChanged:i},{contentType:[t.contentType]})},f.prototype.setupPersistenceServices=function(){var e=this.services,t=this.viewer;e.options.enableSaveAction&&(t.inputManager.setAutoSaveTimeout(-1),e.saveEventListener=function(t){t.contentsSaved&&e.saveResource()},t.editor.addEventListener("InputChanged",e.saveEventListener))},f.prototype.setupContentAssistService=function(){function r(r,i){o.mergeOptions(i,n);var s=new t;return e.contentAssistService.invoke(e.editorContext,i).done(function(e){s.resolve(e.map(function(e){return{proposal:e.proposal,prefix:e.prefix,overwrite:!0,name:e.label?e.label:e.proposal,description:e.description,additionalEdits:e.textReplacements,positions:e.editPositions,escapePosition:e.escapePosition}}))}).fail(function(){s.reject()}),s.promise}var e=this.services,n=e.options,i=this.viewer,s={name:"Xtext content assist service",contentType:[e.contentType]};n.contentAssistCharTriggers&&(s.charTriggers=n.contentAssistCharTriggers,s.excludedStyles=n.contentAssistExcludedStyles,i.settings&&(i.settings.contentAssistAutoTrigger=!0)),e.contentAssistRegistration=i.serviceRegistry.registerService("orion.edit.contentAssist",{computeContentAssist:r},s)},f.prototype._getHighlightAnnotationType=function(e){var t=r.AnnotationType.getType(e);if(t)return e;var n={title:e,style:{styleClass:"annotation "+e},html:"<div class='annotationHTML "+e+"'></div>",overviewStyle:{styleClass:"annotationOverview "+e}};n.rangeStyle={styleClass:"annotationRange "+e};var i=r.AnnotationType.registerType(e,n);return this.services._highlightAnnotationTypes.push(i),this.viewer.editor.getAnnotationStyler().addAnnotationType(i),i},f.prototype.doHighlighting=function(){var e=this.viewer,t=this.services,n=this;t.computeHighlighting().done(function(r){var i=[];for(var s=0;s<r.regions.length;++s){var o=r.regions[s];o.styleClasses.forEach(function(e){i.push({description:"",start:o.offset,end:o.offset+o.length,styleClass:e})})}e.editor.showAnnotations(i,t._highlightAnnotationTypes,null,function(r){return n._getHighlightAnnotationType(r.styleClass,e,t)})})},f.prototype.doValidation=function(){var e=this.viewer,t=this.services;t.validate().done(function(t){e.editor.getEditorContext().showMarkers(t.issues.map(function(e){return{description:e.description,start:e.offset,end:e.offset+e.length,severity:e.severity}}))})},f.prototype.setupHoverService=function(){function r(r,i){var s=new t;return o.mergeOptions(i,n),e.hoverService.invoke(e.editorContext,i).done(function(e){s.resolve({content:e.title+e.content,type:"html"})}).fail(function(){s.resolve(null)}),s.promise}var e=this.services,n=e.options;e.hoverRegistration=this.viewer.serviceRegistry.registerService("orion.edit.hover",{computeHoverInfo:r},{name:"Xtext hover service",contentType:[e.contentType]})},f.prototype.setupOccurrencesService=function(){function r(r,i){var s=new t;return o.mergeOptions(i,n),e.occurrencesService.invoke(e.editorContext,i).done(function(e){var t=e.readRegions.map(function(e){return{start:e.offset,end:e.offset+e.length,readAccess:!0}}),n=e.writeRegions.map(function(e){return{start:e.offset,end:e.offset+e.length,readAccess:!1}});s.resolve(t.concat(n))}).fail(function(){s.resolve({})}),s.promise}var e=this.services,n=e.options,i=this.viewer;i.settings&&(i.settings.showOccurrences=!0),e.occurrencesRegistration=i.serviceRegistry.registerService("orion.edit.occurrences",{computeOccurrences:r},{contentType:[e.contentType]})},f.prototype.setupFormattingService=function(){var e=this.services,n=e.options;if(n.enableFormattingAction){function r(r,i){var s=new t;return o.mergeOptions(i,n),e.formattingService.invoke(e.editorContext,i).done(function(e){s.resolve()}).fail(function(){s.reject()}),s.promise}e.formatCommandRegistration=this.viewer.serviceRegistry.registerService("orion.edit.command",{execute:r},{name:"Xtext formatting service",id:"xtext.formatter",key:["f",!0,!0],contentType:[e.contentType]})}},a});