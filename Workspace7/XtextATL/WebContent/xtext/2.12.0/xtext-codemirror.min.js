define("xtext/compatibility",[],function(){return Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("bind target is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){};return boundFunc=function(){var i=Array.prototype.slice.call(arguments);return n.apply(this instanceof r?this:e,t.concat(i))},r.prototype=this.prototype,boundFunc.prototype=new r,boundFunc}),Array.prototype.map||(Array.prototype.map=function(e,t){if(this==null)throw new TypeError("this is null");if(typeof e!="function")throw new TypeError("callback is not callable");var n=Object(this),r=n.length>>>0,i=new Array(r);for(var s=0;s<r;s++)s in n&&(i[s]=e.call(t,n[s],s,n));return i}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){if(this==null)throw new TypeError("this is null");if(typeof e!="function")throw new TypeError("callback is not callable");var n=Object(this),r=n.length>>>0;for(var i=0;i<r;i++)i in n&&e.call(t,n[i],i,n)}),{}}),define("xtext/services/XtextService",["jquery"],function(e){function n(){}var t={};return n.prototype.initialize=function(){this._serviceType=arguments[1];if(typeof arguments[0]=="string"){this._requestUrl=arguments[0]+"/"+this._serviceType;var e=arguments[2];e&&(this._encodedResourceId=encodeURIComponent(e)),this._updateService=arguments[3]}else{var t=arguments[0];if(t.options){this._requestUrl=t.options.serviceUrl+"/"+this._serviceType;var e=t.options.resourceId;e&&(this._encodedResourceId=encodeURIComponent(e))}this._updateService=t.updateService}},n.prototype.setState=function(e){this._state=e},n.prototype.invoke=function(t,n,r,i){r===undefined&&(r=e.Deferred());if(e.isFunction(this._checkPreconditions)&&!this._checkPreconditions(t,n))return r.reject(),r.promise();var s={contentType:n.contentType},o;e.isFunction(this._initServerData)&&(o=this._initServerData(s,t,n));var u="GET";o&&o.httpMethod&&(u=o.httpMethod);var a=this;if(!o||!o.suppressContent)if(n.sendFullText)s.fullText=t.getText(),u="POST";else{var f=t.getServerState();if(f.updateInProgress)return a._updateService?a._updateService.addCompletionCallback(function(){a.invoke(t,n,r)}):r.reject(),r.promise();f.stateId!==undefined&&(s.requiredStateId=f.stateId)}var l;e.isFunction(this._getSuccessCallback)?l=this._getSuccessCallback(t,n,r):l=function(i){if(i.conflict){if(a._increaseRecursionCount(t)){var s;e.isFunction(a._onConflict)&&(s=a._onConflict(t,i.conflict));if((!s||!s.suppressForcedUpdate)&&!n.sendFullText&&i.conflict=="invalidStateId"&&a._updateService){a._updateService.addCompletionCallback(function(){a.invoke(t,n,r)});var o=t.getServerState();delete o.stateId,delete o.text,a._updateService.invoke(t,n)}else a.invoke(t,n,r)}else r.reject();return!1}if(e.isFunction(a._processResult)){var u=a._processResult(i,t);if(u)return r.resolve(u),!0}r.resolve(i)};var c=function(i,s,o){if(i.status==404&&!n.loadFromServer&&a._increaseRecursionCount(t)){var u;e.isFunction(a._onConflict)&&(u=a._onConflict(t,o));var f=t.getServerState();if((!u||!u.suppressForcedUpdate)&&f.text!==undefined&&a._updateService)return a._updateService.addCompletionCallback(function(){a.invoke(t,n,r)}),delete f.stateId,delete f.text,a._updateService.invoke(t,n),!0}r.reject(o)};return a.sendRequest(t,{type:u,data:s,success:l,error:c},!n.sendFullText),r.promise().always(function(){a._recursionCount=undefined})},n.prototype.sendRequest=function(n,r,i){var s=this;s.setState("started");var o=r.success;r.success=function(t){var r=!0;e.isFunction(o)&&(r=o(t));if(r||r===undefined){s.setState("finished");if(n.xtextServices){var i=n.xtextServices.successListeners;if(i)for(var u=0;u<i.length;u++){var a=i[u];e.isFunction(a)&&a(s._serviceType,t)}}}};var u=r.error;r.error=function(t,r,i){var o=!1;e.isFunction(u)&&(o=u(t,r,i)),o||(s.setState(undefined),s._reportError(n,r,i,t))},r.async=!0;var a=s._requestUrl;!r.data.resource&&s._encodedResourceId&&(a.indexOf("?")>=0?a+="&resource="+s._encodedResourceId:a+="?resource="+s._encodedResourceId);if(i&&t._initPending)t._waitingRequests||(t._waitingRequests=[]),t._waitingRequests.push({requestUrl:a,settings:r});else{if(i&&!t._initDone){t._initPending=!0;var f=r.complete;r.complete=function(n,r){e.isFunction(f)&&f(n,r),delete t._initPending,t._initDone=!0;if(t._waitingRequests){for(var i=0;i<t._waitingRequests.length;i++){var s=t._waitingRequests[i];e.ajax(s.requestUrl,s.settings)}delete t._waitingRequests}}}e.ajax(a,r)}},n.prototype._increaseRecursionCount=function(e){return this._recursionCount===undefined?this._recursionCount=1:this._recursionCount++,this._recursionCount>=10?(this._reportError(e,"warning","Xtext service request failed after 10 attempts.",{}),!1):!0},n.prototype._reportError=function(t,n,r,i){if(t.xtextServices){var s=t.xtextServices.errorListeners;if(s)for(var o=0;o<s.length;o++){var u=s[o];e.isFunction(u)&&u(this._serviceType,n,r,i)}}},n}),define("xtext/services/LoadResourceService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t,n){this.initialize(e,n?"revert":"load",t)}return n.prototype=new e,n.prototype._initServerData=function(e,t,n){return{suppressContent:!0,httpMethod:this._serviceType=="revert"?"POST":"GET"}},n.prototype._getSuccessCallback=function(e,t,n){return function(r){e.setText(r.fullText),e.clearUndoStack(),e.setDirty(r.dirty);var i=e.updateServerState(r.fullText,r.stateId);for(var s=0;s<i.length;s++)i[s](t);n.resolve(r)}},n}),define("xtext/services/SaveResourceService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t){this.initialize(e,"save",t)}return n.prototype=new e,n.prototype._initServerData=function(e,t,n){return{httpMethod:"POST"}},n.prototype._processResult=function(e,t){t.setDirty(!1)},n}),define("xtext/services/HighlightingService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t){this.initialize(e,"highlight",t)}return n.prototype=new e,n.prototype._checkPreconditions=function(e,t){return this._state===undefined},n.prototype._onConflict=function(e,t){return this.setState(undefined),{suppressForcedUpdate:!0}},n}),define("xtext/services/ValidationService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t){this.initialize(e,"validate",t)}return n.prototype=new e,n.prototype._checkPreconditions=function(e,t){return this._state===undefined},n.prototype._onConflict=function(e,t){return this.setState(undefined),{suppressForcedUpdate:!0}},n}),define("xtext/services/UpdateService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t){this.initialize(e,"update",t,this),this._completionCallbacks=[]}return n.prototype=new e,n.prototype.computeDelta=function(e,t,n){var r=0,i=e.length,s=t.length;while(r<i&&r<s&&e.charCodeAt(r)===t.charCodeAt(r))r++;if(r===i&&r===s)return;n.deltaOffset=r;if(r===i){n.deltaText=t.substring(r,s),n.deltaReplaceLength=0;return}if(r===s){n.deltaText="",n.deltaReplaceLength=i-r;return}var o=i-1,u=s-1;while(o>=r&&u>=r&&e.charCodeAt(o)===t.charCodeAt(u))o--,u--;n.deltaText=t.substring(r,u+1),n.deltaReplaceLength=o-r+1},n.prototype.onComplete=function(e,t){var n=this._completionCallbacks;this._completionCallbacks=[];for(var r=0;r<n.length;r++){var i=n[r].callback,s=n[r].params;i(s)}},n.prototype.addCompletionCallback=function(e,t){this._completionCallbacks.push({callback:e,params:t})},n.prototype.invoke=function(e,n,r){r===undefined&&(r=t.Deferred());var i=e.getServerState();if(i.updateInProgress){var s=this;return this.addCompletionCallback(function(){s.invoke(e,n,r)}),r.promise()}var o={contentType:n.contentType},u=e.getText();if(n.sendFullText||i.text===undefined)o.fullText=u;else{this.computeDelta(i.text,u,o);if(o.deltaText===undefined){if(!n.forceUpdate)return r.resolve(i),this.onComplete(),r.promise();o.deltaText="",o.deltaOffset=e.getCaretOffset(),o.deltaReplaceLength=0}o.requiredStateId=i.stateId}i.updateInProgress=!0;var s=this;return s.sendRequest(e,{type:"PUT",data:o,success:function(t){if(t.conflict)return i.text!==undefined?(delete i.updateInProgress,delete i.text,delete i.stateId,s.invoke(e,n,r)):r.reject(t.conflict),!1;var o=e.updateServerState(u,t.stateId);for(var a=0;a<o.length;a++)s.addCompletionCallback(o[a],n);r.resolve(t)},error:function(t,o,u){if(t.status==404&&!n.loadFromServer&&i.text!==undefined)return delete i.updateInProgress,delete i.text,delete i.stateId,s.invoke(e,n,r),!0;r.reject(u)},complete:s.onComplete.bind(s)},!0),r.promise().always(function(){i.updateInProgress=!1})},n}),define("xtext/services/ContentAssistService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t,n){this.initialize(e,"assist",t,n)}return n.prototype=new e,n.prototype.invoke=function(e,n,r){r===undefined&&(r=t.Deferred());var i={contentType:n.contentType};n.offset?i.caretOffset=n.offset:i.caretOffset=e.getCaretOffset();var s=n.selection?n.selection:e.getSelection();if(s.start!=i.caretOffset||s.end!=i.caretOffset)i.selectionStart=s.start,i.selectionEnd=s.end;var o,u="GET",a=undefined,f=e.getServerState();if(n.sendFullText)i.fullText=e.getText(),u="POST";else{i.requiredStateId=f.stateId;if(this._updateService){if(f.text===undefined||f.updateInProgress){var l=this;return this._updateService.addCompletionCallback(function(){l.invoke(e,n,r)}),r.promise()}f.updateInProgress=!0,a=this._updateService.onComplete.bind(this._updateService),o=e.getText(),this._updateService.computeDelta(f.text,o,i),i.deltaText!==undefined&&(u="POST")}}var l=this;l.sendRequest(e,{type:u,data:i,success:function(t){if(t.conflict){if(l._increaseRecursionCount(e))if(a)delete f.updateInProgress,delete f.text,delete f.stateId,l._updateService.addCompletionCallback(function(){l.invoke(e,n,r)}),l._updateService.invoke(e,n);else{var i={};for(var s in n)n.hasOwnProperty(s)&&(i[s]=n[s]);i.sendFullText=!0,l.invoke(e,i,r)}else r.reject(t.conflict);return!1}if(a&&t.stateId!==undefined&&t.stateId!=e.getServerState().stateId){var u=e.updateServerState(o,t.stateId);for(var c=0;c<u.length;c++)l._updateService.addCompletionCallback(u[c],n)}r.resolve(t.entries)},error:function(t,i,s){if(a&&t.status==404&&!n.loadFromServer&&f.text!==undefined)return delete f.updateInProgress,delete f.text,delete f.stateId,l._updateService.addCompletionCallback(function(){l.invoke(e,n,r)}),l._updateService.invoke(e,n),!0;r.reject(s)},complete:a},!n.sendFullText);var c=r.promise();return a&&c.always(function(){f.updateInProgress=!1}),c},n}),define("xtext/services/HoverService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t,n){this.initialize(e,"hover",t,n)}return n.prototype=new e,n.prototype._initServerData=function(e,t,n){n.proposal&&n.proposal.proposal&&(e.proposal=n.proposal.proposal),n.offset?e.caretOffset=n.offset:e.caretOffset=t.getCaretOffset();var r=n.selection?n.selection:t.getSelection();if(r.start!=e.caretOffset||r.end!=e.caretOffset)e.selectionStart=r.start,e.selectionEnd=r.end},n.prototype._getSuccessCallback=function(e,t,n){var r=t.mouseHoverDelay;r||(r=500);var i=(new Date).getTime()+r;return function(r){if(r.conflict||!r.title&&!r.content)n.reject();else{var s=Math.max(0,i-(new Date).getTime());setTimeout(function(){!t.sendFullText&&r.stateId!==undefined&&r.stateId!=e.getServerState().stateId?n.reject():n.resolve(r)},s)}}},n}),define("xtext/services/OccurrencesService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t,n){this.initialize(e,"occurrences",t,n)}return n.prototype=new e,n.prototype._initServerData=function(e,t,n){n.offset?e.caretOffset=n.offset:e.caretOffset=t.getCaretOffset()},n.prototype._getSuccessCallback=function(e,t,n){return function(r){r.conflict||!t.sendFullText&&r.stateId!==undefined&&r.stateId!=e.getServerState().stateId?n.reject():n.resolve(r)}},n}),define("xtext/services/FormattingService",["xtext/services/XtextService","jquery"],function(e,t){function n(e,t,n){this.initialize(e,"format",t,n)}return n.prototype=new e,n.prototype._initServerData=function(e,t,n){var r=n.selection?n.selection:t.getSelection();return r.end>r.start&&(e.selectionStart=r.start,e.selectionEnd=r.end),{httpMethod:"POST"}},n.prototype._processResult=function(e,t){var n;if(e.replaceRegion){var r=t.getText(),i=e.replaceRegion.offset,s=e.replaceRegion.offset+e.replaceRegion.length;t.setText(e.formattedText,i,s),n=r.substring(0,i)+e.formattedText+r.substring(s)}else t.setText(e.formattedText),n=e.formattedText;var o=t.updateServerState(n,e.stateId);for(var u=0;u<o.length;u++)o[u]({})},n}),define("xtext/ServiceBuilder",["jquery","xtext/services/XtextService","xtext/services/LoadResourceService","xtext/services/SaveResourceService","xtext/services/HighlightingService","xtext/services/ValidationService","xtext/services/UpdateService","xtext/services/ContentAssistService","xtext/services/HoverService","xtext/services/OccurrencesService","xtext/services/FormattingService"],function(e,t,n,r,i,s,o,u,a,f,l){function c(e){this.services=e}return c.prototype.createServices=function(){var h=this.services,p=h.options,d=h.editorContext;d.xtextServices=h;var v=this;p.serviceUrl||(p.baseUrl?p.baseUrl.charAt(0)!="/"&&(p.baseUrl="/"+p.baseUrl):p.baseUrl="/",p.serviceUrl=window.location.protocol+"//"+window.location.host+p.baseUrl+"xtext-service");if(p.resourceId)p.xtextLang||(p.xtextLang=p.resourceId.split(/[?#]/)[0].split(".").pop()),p.loadFromServer===undefined&&(p.loadFromServer=!0),p.loadFromServer&&this.setupPersistenceServices&&(h.loadResourceService=new n(p.serviceUrl,p.resourceId,!1),h.loadResource=function(e){return h.loadResourceService.invoke(d,c.mergeOptions(e,p))},h.saveResourceService=new r(p.serviceUrl,p.resourceId),h.saveResource=function(e){return h.saveResourceService.invoke(d,c.mergeOptions(e,p))},h.revertResourceService=new n(p.serviceUrl,p.resourceId,!0),h.revertResource=function(e){return h.revertResourceService.invoke(d,c.mergeOptions(e,p))},this.setupPersistenceServices(),h.loadResource());else{p.loadFromServer===undefined&&(p.loadFromServer=!1);if(p.xtextLang){var m=Math.floor(Math.random()*2147483648).toString(16);p.resourceId=m+"."+p.xtextLang}}this.setupSyntaxHighlighting&&this.setupSyntaxHighlighting();if(p.enableHighlightingService||p.enableHighlightingService===undefined)h.highlightingService=new i(p.serviceUrl,p.resourceId),h.computeHighlighting=function(e){return h.highlightingService.invoke(d,c.mergeOptions(e,p))};if(p.enableValidationService||p.enableValidationService===undefined)h.validationService=new s(p.serviceUrl,p.resourceId),h.validate=function(e){return h.validationService.invoke(d,c.mergeOptions(e,p))};if(this.setupUpdateService){function g(){h.highlightingService&&v.doHighlighting&&(h.highlightingService.setState(undefined),v.doHighlighting()),h.validationService&&v.doValidation&&(h.validationService.setState(undefined),v.doValidation())}p.sendFullText||(h.updateService=new o(p.serviceUrl,p.resourceId),h.update=function(e){return h.updateService.invoke(d,c.mergeOptions(e,p))},h.saveResourceService&&(h.saveResourceService._updateService=h.updateService),d.addServerStateListener(g)),this.setupUpdateService(g)}(p.enableContentAssistService||p.enableContentAssistService===undefined)&&this.setupContentAssistService&&(h.contentAssistService=new u(p.serviceUrl,p.resourceId,h.updateService),h.getContentAssist=function(e){return h.contentAssistService.invoke(d,c.mergeOptions(e,p))},this.setupContentAssistService()),(p.enableHoverService||p.enableHoverService===undefined)&&this.setupHoverService&&(h.hoverService=new a(p.serviceUrl,p.resourceId,h.updateService),h.getHoverInfo=function(e){return h.hoverService.invoke(d,c.mergeOptions(e,p))},this.setupHoverService()),(p.enableOccurrencesService||p.enableOccurrencesService===undefined)&&this.setupOccurrencesService&&(h.occurrencesService=new f(p.serviceUrl,p.resourceId,h.updateService),h.getOccurrences=function(e){return h.occurrencesService.invoke(d,c.mergeOptions(e,p))},this.setupOccurrencesService()),(p.enableFormattingService||p.enableFormattingService===undefined)&&this.setupFormattingService&&(h.formattingService=new l(p.serviceUrl,p.resourceId,h.updateService),h.format=function(e){return h.formattingService.invoke(d,c.mergeOptions(e,p))},this.setupFormattingService());if(p.enableGeneratorService||p.enableGeneratorService===undefined)h.generatorService=new t,h.generatorService.initialize(h,"generate"),h.generatorService._initServerData=function(e,t,n){n.allArtifacts?e.allArtifacts=n.allArtifacts:n.artifactId&&(e.artifact=n.artifactId),n.includeContent!==undefined&&(e.includeContent=n.includeContent)},h.generate=function(e){return h.generatorService.invoke(d,c.mergeOptions(e,p))};if(p.dirtyElement){var y=p.document||document,b;typeof p.dirtyElement=="string"?b=e("#"+p.dirtyElement,y):b=e(p.dirtyElement);var w=p.dirtyStatusClass;w||(w="dirty"),d.addDirtyStateListener(function(e){e?b.addClass(w):b.removeClass(w)})}h.successListeners=[],h.errorListeners=[function(e,t,n,r){p.showErrorDialogs?window.alert("Xtext service '"+e+"' failed: "+n):console.log("Xtext service '"+e+"' failed: "+n)}]},c.prototype.changeResource=function(t){var n=this.services,r=n.options;r.resourceId=t;for(var i in n)if(n.hasOwnProperty(i)){var s=n[i];s._serviceType&&e.isFunction(s.initialize)&&n[i].initialize(r.serviceUrl,s._serviceType,t,n.updateService)}var o=n.editorContext.getServerState();delete o.stateId,delete o.text,r.loadFromServer&&e.isFunction(n.loadResource)&&n.loadResource()},c.copy=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},c.optionName=function(e){var t="data-editor-";if(e.substring(0,t.length)===t){var n=e.substring(t.length);return n=n.replace(/-([a-z])/ig,function(e,t){return t.toUpperCase()}),n}return undefined},c.mergeOptions=function(e,t){if(e){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}return c.copy(t)},c.mergeParentOptions=function(e,t){var n=c.copy(t);for(var r,i=0,s=e.attributes,o=s.length;i<o;i++){r=s.item(i);var u=c.optionName(r.nodeName);if(u){var a=r.nodeValue;if(a==="true"||a==="false")a=a==="true";n[u]=a}}return n},c}),define("xtext/CodeMirrorEditorContext",[],function(){function e(e){this._editor=e,this._serverState={},this._serverStateListeners=[],this._dirty=!1,this._dirtyStateListeners=[]}return e.prototype={getServerState:function(){return this._serverState},updateServerState:function(e,t){return this._serverState.text=e,this._serverState.stateId=t,this._serverStateListeners},addServerStateListener:function(e){this._serverStateListeners.push(e)},getCaretOffset:function(){var e=this._editor;return e.indexFromPos(e.getCursor())},getLineStart:function(e){var t=this._editor;return t.indexFromPos({line:e,ch:0})},getSelection:function(){var e=this._editor;return{start:e.indexFromPos(e.getCursor("from")),end:e.indexFromPos(e.getCursor("to"))}},getText:function(e,t){var n=this._editor;return e&&t?n.getRange(n.posFromIndex(e),n.posFromIndex(t)):n.getValue()},isDirty:function(){return!this._clean},setDirty:function(e){if(e!=this._dirty)for(var t=0;t<this._dirtyStateListeners.length;t++)this._dirtyStateListeners[t](e);this._dirty=e},addDirtyStateListener:function(e){this._dirtyStateListeners.push(e)},clearUndoStack:function(){this._editor.clearHistory()},setCaretOffset:function(e){var t=this._editor;t.setCursor(t.posFromIndex(e))},setSelection:function(e){var t=this._editor;t.setSelection(t.posFromIndex(e.start),t.posFromIndex(e.end))},setText:function(e,t,n){var r=this._editor;t||(t=0),n||(n=r.getValue().length);var i=r.getCursor();r.replaceRange(e,r.posFromIndex(t),r.posFromIndex(n)),r.setCursor(i)}},e}),define("xtext/xtext-codemirror",["jquery","codemirror","codemirror/addon/hint/show-hint","xtext/compatibility","xtext/ServiceBuilder","xtext/CodeMirrorEditorContext","codemirror/mode/javascript/javascript"],function(e,t,n,r,i,s){function u(e,t){this.editor=e,t.editorContext._highlightingMarkers=[],t.editorContext._validationMarkers=[],t.editorContext._occurrenceMarkers=[],i.call(this,t)}var o={};o.createEditor=function(n){n||(n={});var r;e.type(n.parent)==="string"?r=e("#"+n.parent,n.document):n.parent?r=e(n.parent):e.type(n.parentClass)==="string"?r=e("."+n.parentClass,n.document):(r=e("#xtext-editor",n.document),r.length==0&&(r=e(".xtext-editor",n.document)));var s=[];return r.each(function(r,u){var a=i.mergeParentOptions(u,n);a.value||(a.value=e(u).text());var f=t(function(t){e(u).empty().append(t)},a);o.createServices(f,a),s[r]=f}),s.length==1?s[0]:s},u.prototype=new i,o.createServices=function(e,t){(t.enableValidationService||t.enableValidationService===undefined)&&e.setOption("gutters",["annotations-gutter"]);var n={options:t,editorContext:new s(e)},r=new u(e,n);return r.createServices(),n.serviceBuilder=r,e.xtextServices=n,n},o.removeServices=function(e){if(!e.xtextServices)return;var t=e.xtextServices;t.modelChangeListener&&e.off("changes",t.modelChangeListener),t.cursorActivityListener&&e.off("cursorActivity",t.cursorActivityListener),t.saveKeyMap&&e.removeKeyMap(t.saveKeyMap),t.contentAssistKeyMap&&e.removeKeyMap(t.contentAssistKeyMap),t.formatKeyMap&&e.removeKeyMap(t.formatKeyMap);var n=t.editorContext,r=n._highlightingMarkers;if(r)for(var i=0;i<r.length;i++)r[i].clear();n._validationAnnotations&&t.serviceBuilder._clearAnnotations(n._validationAnnotations);var s=n._validationMarkers;if(s)for(var i=0;i<s.length;i++)s[i].clear();var o=n._occurrenceMarkers;if(o)for(var i=0;i<o.length;i++)o[i].clear();delete e.xtextServices},u.prototype.setupSyntaxHighlighting=function(){var e=this.services.options;!e.mode&&e.syntaxDefinition!="none"&&e.xtextLang&&this.editor.setOption("mode","xtext/"+e.xtextLang)},u.prototype.setupUpdateService=function(e){var t=this.services,n=t.editorContext,r=t.options.textUpdateDelay;r||(r=500),t.modelChangeListener=function(i){i._xtext_init||n.setDirty(!0),n._modelChangeTimeout&&clearTimeout(n._modelChangeTimeout),n._modelChangeTimeout=setTimeout(function(){t.options.sendFullText?e():t.update()},r)},(!t.options.resourceId||!t.options.loadFromServer)&&t.modelChangeListener({_xtext_init:!0}),this.editor.on("changes",t.modelChangeListener)},u.prototype.setupPersistenceServices=function(){var e=this.services;if(e.options.enableSaveAction){var t=navigator.userAgent.toLowerCase(),n=function(t){e.saveResource()};e.saveKeyMap=/mac os/.test(t)?{"Cmd-S":n}:{"Ctrl-S":n},this.editor.addKeyMap(e.saveKeyMap)}},u.prototype.setupContentAssistService=function(){var e=this.services,t=e.editorContext;e.contentAssistKeyMap={"Ctrl-Space":function(n){var r=i.copy(e.options),s=n.getCursor();r.offset=n.indexFromPos(s),e.contentAssistService.invoke(t,r).done(function(e){n.showHint({hint:function(t,n){return{list:e.map(function(e){var t;e.label?t=e.label:t=e.proposal,e.description&&(t+=" ("+e.description+")");var n=0;return e.prefix&&(n=e.prefix.length),{text:e.proposal,displayText:t,from:{line:s.line,ch:s.ch-n}}}),to:s}}})})}},this.editor.addKeyMap(e.contentAssistKeyMap)},u.prototype.doHighlighting=function(){var e=this.services,t=e.editorContext,n=this.editor;e.computeHighlighting().always(function(){var e=t._highlightingMarkers;if(e)for(var n=0;n<e.length;n++)e[n].clear();t._highlightingMarkers=[]}).done(function(e){for(var r=0;r<e.regions.length;++r){var i=e.regions[r],s=n.posFromIndex(i.offset),o=n.posFromIndex(i.offset+i.length);i.styleClasses.forEach(function(e){var r=n.markText(s,o,{className:e});t._highlightingMarkers.push(r)})}})};var a={error:30,warning:20,info:10};return u.prototype._getAnnotationWeight=function(e){return a[e]!==undefined?a[e]:0},u.prototype._clearAnnotations=function(e){var t=this.editor;for(var n=0;n<e.length;n++){var r=e[n];r&&(t.setGutterMarker(n,"annotations-gutter",null),e[n]=undefined)}},u.prototype._refreshAnnotations=function(t){var n=this.editor;for(var r=0;r<t.length;r++){var i=t[r];if(i){var s=' class="xtext-annotation_'+i.type+'"',o=i.description?' title="'+i.description.replace(/"/g,"&quot;")+'"':"",u=e("<div"+s+o+"></div>").get(0);n.setGutterMarker(r,"annotations-gutter",u)}}},u.prototype.doValidation=function(){var e=this.services,t=e.editorContext,n=this.editor,r=this;e.validate().always(function(){t._validationAnnotations?r._clearAnnotations(t._validationAnnotations):t._validationAnnotations=[];var e=t._validationMarkers;if(e)for(var n=0;n<e.length;n++)e[n].clear();t._validationMarkers=[]}).done(function(e){var i=t._validationAnnotations;for(var s=0;s<e.issues.length;s++){var o=e.issues[s],u=i[o.line-1],a=r._getAnnotationWeight(o.severity);u?(u.weight<a&&(u.type=o.severity,u.weight=a),u.description?u.description+="\n"+o.description:u.description=o.description):i[o.line-1]={type:o.severity,weight:a,description:o.description};var f=n.posFromIndex(o.offset),l=n.posFromIndex(o.offset+o.length),c=n.markText(f,l,{className:"xtext-marker_"+o.severity,title:o.description});t._validationMarkers.push(c)}r._refreshAnnotations(i)})},u.prototype.setupOccurrencesService=function(){var e=this.services,t=e.editorContext,n=e.options.selectionUpdateDelay;n||(n=550);var r=this.editor,s=this;e.cursorActivityListener=function(){t._selectionChangeTimeout&&clearTimeout(t._selectionChangeTimeout),t._selectionChangeTimeout=setTimeout(function(){var n=i.copy(e.options),s=r.getCursor();n.offset=r.indexFromPos(s),e.occurrencesService.invoke(t,n).always(function(){var e=t._occurrenceMarkers;if(e)for(var n=0;n<e.length;n++)e[n].clear();t._occurrenceMarkers=[]}).done(function(e){for(var n=0;n<e.readRegions.length;n++){var i=e.readRegions[n],s=r.posFromIndex(i.offset),o=r.posFromIndex(i.offset+i.length),u=r.markText(s,o,{className:"xtext-marker_read"});t._occurrenceMarkers.push(u)}for(var n=0;n<e.writeRegions.length;n++){var i=e.writeRegions[n],s=r.posFromIndex(i.offset),o=r.posFromIndex(i.offset+i.length),u=r.markText(s,o,{className:"xtext-marker_write"});t._occurrenceMarkers.push(u)}})},n)},r.on("cursorActivity",e.cursorActivityListener)},u.prototype.setupFormattingService=function(){var e=this.services;if(e.options.enableFormattingAction){var t=navigator.userAgent.toLowerCase(),n=function(t){e.format()};e.formatKeyMap=/mac os/.test(t)?{"Shift-Cmd-F":n}:{"Shift-Ctrl-S":n},this.editor.addKeyMap(e.formatKeyMap)}},o});